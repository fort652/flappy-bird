<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Achievements - Tweety Bird</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .achievement-card {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.05)
        );
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .achievement-locked {
        filter: grayscale(100%) brightness(0.6);
      }

      .achievement-unlocked {
        animation: unlockPulse 0.6s ease-out;
      }

      @keyframes unlockPulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .progress-bar {
        background: linear-gradient(90deg, #10b981, #059669);
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 min-h-screen text-white"
  >
    <!-- Header -->
    <div class="text-center pt-8 pb-6">
      <h1 class="text-4xl font-bold text-yellow-400 mb-2">Achievements</h1>
      <p class="text-lg text-gray-300">Unlock your potential!</p>
    </div>

    <!-- Stats Overview -->
    <div class="mx-4 mb-6 p-4 bg-white/10 rounded-2xl backdrop-blur-sm">
      <div class="grid grid-cols-2 gap-4 text-center">
        <div>
          <div
            class="text-2xl font-bold text-yellow-400"
            id="totalAchievements"
          >
            0
          </div>
          <div class="text-sm text-gray-300">Unlocked</div>
        </div>
        <div>
          <div class="text-2xl font-bold text-blue-400" id="totalProgress">
            0%
          </div>
          <div class="text-sm text-gray-300">Progress</div>
        </div>
      </div>
      <div class="mt-3 bg-gray-700 rounded-full h-2">
        <div
          class="progress-bar h-2 rounded-full transition-all duration-500"
          id="progressBar"
          style="width: 0%"
        ></div>
      </div>
    </div>

    <!-- Achievement Categories -->
    <div class="mx-4 mb-6">
      <div class="flex gap-2 overflow-x-auto pb-2">
        <button
          class="category-btn px-4 py-2 bg-yellow-500 text-black rounded-full whitespace-nowrap font-medium"
          data-category="all"
        >
          All
        </button>
        <button
          class="category-btn px-4 py-2 bg-gray-600 text-white rounded-full whitespace-nowrap"
          data-category="beginner"
        >
          Beginner
        </button>
        <button
          class="category-btn px-4 py-2 bg-gray-600 text-white rounded-full whitespace-nowrap"
          data-category="intermediate"
        >
          Intermediate
        </button>
        <button
          class="category-btn px-4 py-2 bg-gray-600 text-white rounded-full whitespace-nowrap"
          data-category="expert"
        >
          Expert
        </button>
        <button
          class="category-btn px-4 py-2 bg-gray-600 text-white rounded-full whitespace-nowrap"
          data-category="special"
        >
          Special
        </button>
      </div>
    </div>

    <!-- Achievements Grid -->
    <div class="mx-4 mb-20 grid grid-cols-1 gap-4" id="achievementsGrid">
      <!-- Achievements will be populated by JavaScript -->
    </div>

    <!-- Navigation -->
    <div
      class="fixed bottom-0 left-0 right-0 bg-gray-900/90 backdrop-blur-sm p-4"
    >
      <div class="flex justify-center gap-4">
        <button
          onclick="debugAchievements()"
          class="bg-purple-600 text-white px-4 py-2 rounded-full text-sm hover:bg-purple-700 transition-colors"
        >
          Debug
        </button>
        <button
          onclick="window.location.href='../index.html'"
          class="bg-blue-600 text-white px-6 py-3 rounded-full font-medium hover:bg-blue-700 transition-colors"
        >
          ‚Üê Back to Menu
        </button>
      </div>
    </div>

    <script>
      // Achievement data
      const achievements = [
        {
          id: "first_flight",
          title: "First Flight",
          description: "Complete your first game",
          category: "beginner",
          icon: "üê¶",
          requirement: 1,
          type: "games_played",
          reward: "Unlock Blue Bird character",
        },
        {
          id: "score_10",
          title: "Getting Started",
          description: "Score 10 points in a single game",
          category: "beginner",
          icon: "‚≠ê",
          requirement: 10,
          type: "high_score",
          reward: "Unlock Blue Bird character",
        },
        {
          id: "score_25",
          title: "Rising Star",
          description: "Score 25 points in a single game",
          category: "intermediate",
          icon: "üåü",
          requirement: 25,
          type: "high_score",
          reward: "Unlock Purple Bird character + Winter background",
        },
        {
          id: "score_50",
          title: "Bird Master",
          description: "Score 50 points in a single game",
          category: "intermediate",
          icon: "üèÜ",
          requirement: 50,
          type: "high_score",
          reward: "Unlock Galaxy background",
        },
        {
          id: "score_75",
          title: "Advanced Player",
          description: "Score 75 points in a single game",
          category: "intermediate",
          icon: "üéØ",
          requirement: 75,
          type: "high_score",
          reward: "Unlock Autumn background",
        },
        {
          id: "score_100",
          title: "Legendary Bird",
          description: "Score 100 points in a single game",
          category: "expert",
          icon: "üëë",
          requirement: 100,
          type: "high_score",
          reward: "Unlock Space background + Golden Bird character",
        },
        {
          id: "score_150",
          title: "Master Flier",
          description: "Score 150 points in a single game",
          category: "expert",
          icon: "üöÄ",
          requirement: 150,
          type: "high_score",
          reward: "Unlock Space background",
        },
        {
          id: "score_200",
          title: "Ultimate Legend",
          description: "Score 200 points in a single game",
          category: "expert",
          icon: "üíé",
          requirement: 200,
          type: "high_score",
          reward: "Unlock Space background",
        },
        {
          id: "games_10",
          title: "Dedicated Player",
          description: "Play 10 games",
          category: "beginner",
          icon: "üéÆ",
          requirement: 10,
          type: "games_played",
          reward: "Unlock Ocean background",
        },
        {
          id: "games_25",
          title: "Regular Player",
          description: "Play 25 games",
          category: "intermediate",
          icon: "üé≤",
          requirement: 25,
          type: "games_played",
          reward: "Unlock Forest background",
        },
        {
          id: "games_50",
          title: "Veteran Player",
          description: "Play 50 games",
          category: "intermediate",
          icon: "üéØ",
          requirement: 50,
          type: "games_played",
          reward: "Unlock Mountain background",
        },
        {
          id: "games_100",
          title: "Ultimate Player",
          description: "Play 100 games",
          category: "expert",
          icon: "üíé",
          requirement: 100,
          type: "games_played",
          reward: "Unlock City background",
        },
        {
          id: "perfect_5",
          title: "Perfect Player",
          description: "Achieve 5 perfect runs",
          category: "special",
          icon: "‚ú®",
          requirement: 5,
          type: "perfect_runs",
          reward: "Unlock City background + Ninja Bird character",
        },
        {
          id: "perfect_10",
          title: "Perfect Master",
          description: "Achieve 10 perfect runs",
          category: "special",
          icon: "üí´",
          requirement: 10,
          type: "perfect_runs",
          reward: "Unlock Ninja Bird character",
        },
        {
          id: "daily_player",
          title: "Daily Player",
          description: "Play for 7 consecutive days",
          category: "special",
          icon: "üìÖ",
          requirement: 7,
          type: "consecutive_days",
          reward: "Unlock Rainbow background + Rainbow Bird character",
        },
        {
          id: "distance_10k",
          title: "Long Distance Flier",
          description: "Fly a total distance of 10km",
          category: "special",
          icon: "üåç",
          requirement: 10000,
          type: "total_distance",
          reward: "Unlock Desert background",
        },
      ];

      let currentCategory = "all";
      let unlockedAchievements = new Set();

      // Initialize achievements
      function initAchievements() {
        loadProgress();
        renderAchievements();
        updateStats();
      }

      // Load progress from localStorage
      function loadProgress() {
        const saved = localStorage.getItem("flappyBirdProgress");
        if (saved) {
          const progress = JSON.parse(saved);
          unlockedAchievements = new Set(progress.unlocked || []);
          console.log("Loaded progress:", progress);
          console.log(
            "Unlocked achievements:",
            Array.from(unlockedAchievements)
          );
        } else {
          console.log("No progress found, starting fresh");
        }
      }

      // Save progress to localStorage
      function saveProgress() {
        const progress = {
          unlocked: Array.from(unlockedAchievements),
          timestamp: Date.now(),
        };
        localStorage.setItem("flappyBirdProgress", JSON.stringify(progress));
      }

      // Render achievements
      function renderAchievements() {
        const grid = document.getElementById("achievementsGrid");
        const filteredAchievements =
          currentCategory === "all"
            ? achievements
            : achievements.filter((a) => a.category === currentCategory);

        grid.innerHTML = filteredAchievements
          .map((achievement) => {
            const isUnlocked = unlockedAchievements.has(achievement.id);
            const progress = getAchievementProgress(achievement);
            const progressPercent = Math.min(
              (progress / achievement.requirement) * 100,
              100
            );

            return `
          <div class="achievement-card rounded-2xl p-4 ${
            isUnlocked ? "achievement-unlocked" : "achievement-locked"
          }">
            <div class="flex items-center gap-4">
              <div class="text-4xl">${achievement.icon}</div>
              <div class="flex-1">
                <h3 class="text-lg font-semibold ${
                  isUnlocked ? "text-yellow-400" : "text-gray-400"
                }">${achievement.title}</h3>
                <p class="text-sm text-gray-300 mb-2">${
                  achievement.description
                }</p>
                <div class="text-xs text-blue-300 mb-2">Reward: ${
                  achievement.reward
                }</div>
                <div class="bg-gray-700 rounded-full h-2 mb-2">
                  <div class="bg-blue-500 h-2 rounded-full transition-all duration-500" style="width: ${progressPercent}%"></div>
                </div>
                <div class="text-xs text-gray-400">${progress}/${
              achievement.requirement
            }</div>
              </div>
              ${
                isUnlocked
                  ? '<div class="text-2xl text-yellow-400">‚úì</div>'
                  : ""
              }
            </div>
          </div>
        `;
          })
          .join("");
      }

      // Get achievement progress
      function getAchievementProgress(achievement) {
        const stats = JSON.parse(
          localStorage.getItem("flappyBirdStats") || "{}"
        );

        switch (achievement.type) {
          case "games_played":
            return stats.gamesPlayed || 0;
          case "high_score":
            return stats.highScore || 0;
          case "perfect_runs":
            return stats.perfectRuns || 0;
          case "consecutive_days":
            return stats.consecutiveDays || 0;
          case "total_distance":
            return Math.round((stats.totalDistance || 0) / 100); // Convert to meters for display
          default:
            return 0;
        }
      }

      // Update statistics
      function updateStats() {
        const totalUnlocked = unlockedAchievements.size;
        const totalAchievements = achievements.length;
        const progressPercent = Math.round(
          (totalUnlocked / totalAchievements) * 100
        );

        document.getElementById("totalAchievements").textContent =
          totalUnlocked;
        document.getElementById(
          "totalProgress"
        ).textContent = `${progressPercent}%`;
        document.getElementById(
          "progressBar"
        ).style.width = `${progressPercent}%`;

        // Debug logging
        console.log(
          `Achievements: ${totalUnlocked}/${totalAchievements} (${progressPercent}%)`
        );
        console.log("Unlocked achievements:", Array.from(unlockedAchievements));
      }

      // Category filter
      document.addEventListener("click", (e) => {
        if (e.target.classList.contains("category-btn")) {
          // Update active category
          document.querySelectorAll(".category-btn").forEach((btn) => {
            btn.className =
              "category-btn px-4 py-2 bg-gray-600 text-white rounded-full whitespace-nowrap";
          });
          e.target.className =
            "category-btn px-4 py-2 bg-yellow-500 text-black rounded-full whitespace-nowrap font-medium";

          currentCategory = e.target.dataset.category;
          renderAchievements();
        }
      });

      // Initialize on load
      window.addEventListener("load", initAchievements);

      // Debug function to help troubleshoot
      function debugAchievements() {
        const progress = localStorage.getItem("flappyBirdProgress");
        const stats = localStorage.getItem("flappyBirdStats");

        console.log("=== ACHIEVEMENT DEBUG ===");
        console.log("Progress data:", progress ? JSON.parse(progress) : "None");
        console.log("Stats data:", stats ? JSON.parse(stats) : "None");
        console.log("Current unlocked:", Array.from(unlockedAchievements));

        // Show debug info in alert
        let debugInfo = "=== ACHIEVEMENT DEBUG ===\n\n";
        debugInfo += `Progress: ${progress ? "Found" : "Missing"}\n`;
        debugInfo += `Stats: ${stats ? "Found" : "Missing"}\n`;
        debugInfo += `Unlocked: ${unlockedAchievements.size}\n`;
        debugInfo += `Total: ${achievements.length}\n\n`;

        if (progress) {
          const p = JSON.parse(progress);
          debugInfo += `Unlocked IDs: ${
            p.unlocked ? p.unlocked.join(", ") : "None"
          }\n`;
          debugInfo += `Characters: ${
            p.unlockedCharacters ? p.unlockedCharacters.join(", ") : "None"
          }\n`;
          debugInfo += `Backgrounds: ${
            p.unlockedBackgrounds ? p.unlockedBackgrounds.join(", ") : "None"
          }\n`;
        }

        if (stats) {
          const s = JSON.parse(stats);
          debugInfo += `\nGames Played: ${s.gamesPlayed || 0}\n`;
          debugInfo += `High Score: ${s.highScore || 0}\n`;
          debugInfo += `Perfect Runs: ${s.perfectRuns || 0}\n`;
          debugInfo += `Consecutive Days: ${s.consecutiveDays || 0}\n`;
          debugInfo += `Total Distance: ${Math.round(
            (s.totalDistance || 0) / 100
          )}m\n`;
        }

        alert(debugInfo);
      }
    </script>
  </body>
</html>
