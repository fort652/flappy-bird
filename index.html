<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .background-image {
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        transition: background-image 0.5s ease;
      }
    </style>
  </head>
  <body class="bg-gray-800 m-0 p-0 overflow-hidden font-sans h-screen">
    <div
      class="relative w-screen h-screen background-image"
      id="mainBackground"
    >
      <!-- Header -->
      <div class="text-center mt-8 md:mt-16 px-4">
        <h1 class="text-yellow-400 text-5xl sm:text-6xl md:text-7xl lg:text-8xl xl:text-[100px] font-bold">Tweety Bird</h1>
        <p class="text-white text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-[60px] font-medium">High Score:</p>
        <div class="text-white text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-[80px] font-bold text-yellow-400" id="highScoreDisplay">0</div>
      </div>

      <!-- Menu Buttons -->
      <div class="flex flex-col gap-4 md:gap-6 mx-4 md:ml-10 mt-16 md:mt-32">
        <game-button
          title="Achievements"
          route="pages/achievements.html"
          image="assets/images/buttons/menu/achievement.png"
        ></game-button>
        <game-button
          title="Statistics"
          route="pages/stats.html"
          image="assets/images/buttons/menu/pie-chart.png"
        ></game-button>
        <game-button
          title="Background"
          route="pages/backgrounds.html"
          image="assets/images/buttons/menu/canvas.png"
        ></game-button>
        <game-button
          title="Settings"
          route="pages/settings.html"
          image="assets/images/buttons/menu/gear.png"
        ></game-button>
        <game-button
          title="Characters"
          route="pages/characters.html"
          image=""
          id="characterButton"
        ></game-button>
      </div>

      <!-- Play Button -->
      <div class="flex justify-center mt-16 md:mt-32">
        <play-button
          title="Play"
          route="game.html"
          image="assets/images/buttons/play.png"
        ></play-button>
      </div>

      <!-- Navigation -->
      <div
        class="flex justify-center px-4 md:px-10 relative bottom-0 left-0 right-0 mt-16 md:mt-32"
      >
        <button
          class="bg-blue-500 rounded-full w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 lg:w-[100px] lg:h-[100px] flex items-center justify-center cursor-pointer text-white text-xl font-bold hover:bg-blue-600 transition-colors"
        >
          ‚Üê
        </button>
      </div>
    </div>
    <script type="module">
      import "./components/PlayButton.js";
      import "./components/Buttons.js";
    </script>

    <script>
      function loadSelectedBackground() {
        const selectedBackground =
          localStorage.getItem("flappyBirdBackground") || "default";
        const backgroundElement = document.getElementById("mainBackground");

        const img = new Image();
        img.onload = function () {
          backgroundElement.style.backgroundImage = `url(assets/images/backgrounds/${selectedBackground}.jpg)`;
          backgroundElement.style.backgroundColor = "transparent";
        };
        img.onerror = function () {
          console.log(
            `Background image not found: ${selectedBackground}.jpg, using fallback`
          );
          backgroundElement.style.backgroundImage = "none";
          backgroundElement.style.backgroundColor = "rgb(31, 41, 55)"; // bg-gray-800
        };

        img.src = `assets/images/backgrounds/${selectedBackground}.jpg`;

        const textElements = document.querySelectorAll("h1, p");
        textElements.forEach((element) => {
          element.style.textShadow = "2px 2px 4px rgba(0, 0, 0, 0.8)";
        });
      }

      function loadHighScore() {
        const highScore = localStorage.getItem("flappyBirdHighScore") || 0;
        const highScoreDisplay = document.getElementById("highScoreDisplay");
        if (highScoreDisplay) {
          highScoreDisplay.textContent = highScore;
        }
      }

      function updateCharacterButton() {
        const characterButton = document.getElementById("characterButton");
        if (characterButton && characterButton.loadSelectedCharacter) {
          const isInPagesFolder = window.location.pathname.includes("/pages/");
          const assetsPath = isInPagesFolder ? "../" : "";
          characterButton.loadSelectedCharacter(assetsPath);
        }
      }

      function refreshCharacterDisplay() {
        // Force refresh of character button
        setTimeout(() => {
          updateCharacterButton();
        }, 100);
      }

      window.addEventListener("load", () => {
        loadSelectedBackground();
        loadHighScore();
        updateCharacterButton();
      });

      window.addEventListener("storage", function (e) {
        if (e.key === "flappyBirdBackground") {
          loadSelectedBackground();
        }
        if (e.key === "flappyBirdHighScore") {
          loadHighScore();
        }
        if (e.key === "flappyBirdCharacter") {
          updateCharacterButton();
        }
      });

      window.addEventListener("backgroundChanged", function (e) {
        loadSelectedBackground();
      });

      // Listen for character changes from other pages
      window.addEventListener("characterChanged", function (e) {
        refreshCharacterDisplay();
      });
    </script>
  </body>
</html>
